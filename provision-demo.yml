---

  - name: build out satellite
  hosts:
    - satellite
  gather_facts: no
  pre_tasks:
    - name: print out host info
      debug:
        msg: "{{ hostvars[inventory_hostname] }}"
  roles:
    - jjaswanson4.utilities.idm_dns_records
    - jjaswanson4.utilities.provision_via_satellite
    - jjaswanson4.utilities.add_virtual_disk
    - jjaswanson4.utilities.common_config
    - redhat.rhel_system_roles.selinux
    - redhat.rhel_system_roles.timesync
    - jjaswanson4.setup_rhel_for_satellite.setup_storage
    - jjaswanson4.install_satellite.install_satellite
    - jjaswanson4.configure_satellite.configure_satellite_foreman
  tasks:
    - name: build satellite by organization
      include_role:
        name: jjaswanson4.configure_satellite.configure_satellite_katello
      loop_control:
        loop_var: organization
      loop: "{{ satellite.katello }}"
    - name: do that again but for katello dependent pieces
      include_role:
        name: jjaswanson4.configure_satellite.configure_satellite_foreman
      vars:
        requires_katello_content: true

- name: build out tower
  hosts:
    - tower
  gather_facts: no
  roles:
    - jjaswanson4.utilities.idm_dns_records
    - jjaswanson4.utilities.provision_via_satellite
    - jjaswanson4.utilities.common_config
    - redhat.rhel_system_roles.selinux
    - redhat.rhel_system_roles.timesync
    - jjaswanson4.utilities.install_aap

- name: configure tower
  hosts:
    - localhost
  vars_files:
    - vars/tower-configuration.yml
  roles:
    - redhat_cop.tower_configuration.license
    - redhat_cop.tower_configuration.organizations
    - redhat_cop.tower_configuration.projects
    - redhat_cop.tower_configuration.inventories
    - redhat_cop.tower_configuration.hosts

- name: provision managed hosts
  hosts:
    - demo_hosts
  gather_facts: false
  roles:
    - jjaswanson4.utilities.idm_dns_records
    - jjaswanson4.utilities.provision_via_satellite
    - jjaswanson4.utilities.common_config
    - redhat.rhel_system_roles.selinux
    - redhat.rhel_system_roles.timesync
    - jjaswanson4.utilities.add_virtual_disk
    - redhat.rhel_system_roles.storage
    - /Users/jswanson/code/ansible-utilities/roles/mount_nfs_shares
    - sap-preconfigure
    - redhat_sap.sap_hostagent